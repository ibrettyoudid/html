<html>
<head>
<style>
.neck
{
    position: absolute;
}
td
{
    text-align: center;
    vertical-align: middle;
}
table.fretboard
{
    z-index: 0;
    position: absolute;
    top: 0;
    border-collapse: collapse;
}
td.fretboard
{
    border-right: 1px solid;
}
table.strings
{
    z-index: 1;
    position: relative;
    top: 0;
    border-bottom: 1px solid;
    border-collapse: collapse;
}
td.strings
{
    border-top: 1px solid;
}
table.fretclick
{
    z-index: 2;
    position: absolute;
    top: 0;
}
</style>
</head>
<body>
    <table columns=13>
        <tr>
            <td width=200 height=40>0</td>
            <td width=189>1</td>
            <td width=178>2</td>
            <td width=168>3</td>
            <td width=159>4</td>
            <td width=150>5</td>
            <td width=141>6</td>
            <td width=133>7</td>
            <td width=126>8</td>
            <td width=119>9</td>
            <td width=112>10</td>
            <td width=106>11</td>
            <td width=100>12</td>
        </tr>
    </table>
<div class=neck>
    <table id=fretboard class=fretboard columns=13 rows=6>
        <tr>
            <td class=fretboard width=200 height=40></td>
            <td class=fretboard width=189></td>
            <td class=fretboard width=178></td>
            <td class=fretboard width=168></td>
            <td class=fretboard width=159></td>
            <td class=fretboard width=150></td>
            <td class=fretboard width=141></td>
            <td class=fretboard width=133></td>
            <td class=fretboard width=126></td>
            <td class=fretboard width=119></td>
            <td class=fretboard width=112></td>
            <td class=fretboard width=106></td>
            <td class=fretboard width=100></td>
        </tr>
        <tr><td class=fretboard height=40></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td>
        <td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td></tr>
        <tr><td class=fretboard height=40></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td>
        <td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td></tr>
        <tr><td class=fretboard height=40></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td>
        <td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td></tr>
        <tr><td class=fretboard height=40></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td>
        <td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td></tr>
        <tr><td class=fretboard height=40></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td>
        <td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td><td class=fretboard></td></tr>
    </table>
    <table class=strings columns=13 rows=7>
        <tr><td class=strings height=20 colspan=13></td></tr>
        <tr><td class=strings height=40 colspan=13></td></tr>
        <tr><td class=strings height=40 colspan=13></td></tr>
        <tr>
            <td class=strings height=40 width=200></td>
            <td class=strings width=189></td>
            <td class=strings width=178></td>
            <td class=strings width=168></td>
            <td class=strings width=159></td>
            <td class=strings width=150></td>
            <td class=strings width=141></td>
            <td class=strings width=133></td>
            <td class=strings width=126></td>
            <td class=strings width=119></td>
            <td class=strings width=112></td>
            <td class=strings width=106></td>
            <td class=strings width=100></td>
        </tr>
        <tr><td class=strings height=40 colspan=13></td></tr>
        <tr><td class=strings height=40 colspan=13></td></tr>
        <tr><td class=strings height=20 colspan=13></td></tr>
    </table>
    <table class=fretclick id=fretclick rows=6 columns=13>
        <tr>
            <td width=200 height=40></td>
            <td width=189></td>
            <td width=178></td>
            <td width=168></td>
            <td width=159></td>
            <td width=150></td>
            <td width=141></td>
            <td width=133></td>
            <td width=126></td>
            <td width=119></td>
            <td width=112></td>
            <td width=106></td>
            <td width=100></td>
        </tr>
        <tr><td height=40></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td height=40></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td height=40></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td height=40></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td height=40></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    </table>
    <table id=chord class=chord>
        <tr><td></td><td>A</td><td>A#</td><td>B</td><td>C</td><td>C#</td><td>D</td><td>D#</td><td>E</td><td>F</td><td>F#</td><td>G</td><td>G#</td></tr>
        <tr><td>major</td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td></tr>
        <tr><td>minor</td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td></tr>
        <tr><td>7</td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td></tr>
        <tr><td>major 7</td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td></tr>
        <tr><td>minor 7</td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td><td class=chord></td></tr>
    </table>
    <table id=notes>
        <tr><td>root</td><td>m2</td><td>2</td><td>m3</td><td>3</td><td>4</td><td>a4</td><td>5</td><td>m6</td><td>6</td><td>m7</td><td>7</td></tr>
        <tr><td>8</td><td>b9</td><td>9</td><td>b10</td><td>10</td><td>11</td><td>#11</td><td>12</td><td>b13</td><td>13</td><td>b14</td><td>14</td></tr>
        <tr><td>A</td><td>A#</td><td>B</td><td>C</td><td>C#</td><td>D</td><td>D#</td><td>E</td><td>F</td><td>F#</td><td>G</td><td>G#</td></tr>
        <tr><td>A#</td><td>B</td><td>C</td><td>C#</td><td>D</td><td>D#</td><td>E</td><td>F</td><td>F#</td><td>G</td><td>G#</td><td>A</td></tr>
        <tr><td>B</td><td>C</td><td>C#</td><td>D</td><td>D#</td><td>E</td><td>F</td><td>F#</td><td>G</td><td>G#</td><td>A</td><td>A#</td></tr>
        <tr><td>C</td><td>C#</td><td>D</td><td>D#</td><td>E</td><td>F</td><td>F#</td><td>G</td><td>G#</td><td>A</td><td>A#</td><td>B</td></tr>
        <tr><td>C#</td><td>D</td><td>D#</td><td>E</td><td>F</td><td>F#</td><td>G</td><td>G#</td><td>A</td><td>A#</td><td>B</td><td>C</td></tr>
        <tr><td>D</td><td>D#</td><td>E</td><td>F</td><td>F#</td><td>G</td><td>G#</td><td>A</td><td>A#</td><td>B</td><td>C</td><td>C#</td></tr>
        <tr><td>D#</td><td>E</td><td>F</td><td>F#</td><td>G</td><td>G#</td><td>A</td><td>A#</td><td>B</td><td>C</td><td>C#</td><td>D</td></tr>
        <tr><td>E</td><td>F</td><td>F#</td><td>G</td><td>G#</td><td>A</td><td>A#</td><td>B</td><td>C</td><td>C#</td><td>D</td><td>D#</td></tr>
        <tr><td>F</td><td>F#</td><td>G</td><td>G#</td><td>A</td><td>A#</td><td>B</td><td>C</td><td>C#</td><td>D</td><td>D#</td><td>E</td></tr>
        <tr><td>F#</td><td>G</td><td>G#</td><td>A</td><td>A#</td><td>B</td><td>C</td><td>C#</td><td>D</td><td>D#</td><td>E</td><td>F</td></tr>
        <tr><td>G</td><td>G#</td><td>A</td><td>A#</td><td>B</td><td>C</td><td>C#</td><td>D</td><td>D#</td><td>E</td><td>F</td><td>F#</td></tr>
        <tr><td>G#</td><td>A</td><td>A#</td><td>B</td><td>C</td><td>C#</td><td>D</td><td>D#</td><td>E</td><td>F</td><td>F#</td><td>G</td></tr>
    </table>
    <table id="chordfret">
        <tr><td>Score</td><td>Barres</td><td>Fingers</td><td>Span</td><td>Coverage</td><td>String 1</td><td>String 2</td><td>String 3</td><td>String 4</td><td>String 5</td><td>String 6</td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
        <tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr>
    </table>
</div>
<script type="text/javascript">
    let nstrings = 6;
    let intvs = ["r", "m2", "2", "m3", "3" , "4", "a4", "5", "m6", "6" ,"m7", "7", "8", "b9", "9", "b10", "10", "11", "#11", "12", "b13", "13", "b14", "14"]
    let notes = ["A", "A#", "B", "C" , "C#", "D", "D#", "E", "F" , "F#","G" , "G#"];
    let lit   = [ 1 ,  0  ,  0 ,  2  ,  0 ,   0 ,  0  ,  3 ,  0  ,  0 ,  0  ,  0 ];
    let tuning = [7, 2, 10, 5, 0, 7];
    let colours = ["white", "#ff8080", "#80ff80", "#8080ff", "#80ffff", "#808080", "#ffff80"];
    let chords = [[0, 4, 7], [0, 3, 7], [0, 4, 7, 10], [0, 4, 7, 11], [0, 3, 7, 10]];
    let fretboard = document.getElementById("fretboard");
    let chordgrid = document.getElementById("chord");
    let notegrid  = document.getElementById("notes");
    let chordfretgrid = document.getElementById("chordfret");
    let fretclick = document.getElementById("fretclick");
    let chordfrets = [];
    let stringfret = new Array(nstrings);
    function noteat(x, y)
    {
        return (tuning[y]+x) % 12;
    }
    function donotes()
    {
        for (let y = 0; y < nstrings; ++y)
        {
            for (let x = 0; x < 13; ++x)
            {
                let n = noteat(x, y);
                let cell = fretboard.rows[y].cells[x];
                cell.innerText = notes[n];
                cell.style.background = colours[lit[n]];
            }
        }
        for (let y = 0; y < nstrings; ++y)
        {
            for (let x = 0; x < 13; ++x)
            {
                let n = noteat(x, y);
                let cell = fretclick.rows[y].cells[x];
                cell.onclick = lightnote(n);
            }
        }
        for (let y = 0; y < 12; ++y)
        {
            for (let x = 0; x < 12; ++x)
            {
                let n = (x+y) % 12;
                let cell = notegrid.rows[y+2].cells[x];
                cell.innerText = notes[n];
                cell.style.background = colours[lit[n]];
                cell.onclick = lightnote(n);
            }
        }
        bestchord();
    }
    function lightnote(n)
    {
        function go()
        {
            if (lit[n] == 0) lit[n] = 1; else lit[n] = 0;
            let y = 0;
            for (let x = 0; x < 12; ++x)
            {
                if (lit[x] > 0)
                {
                    ++y;
                    lit[x] = y;
                }
            }
            donotes();
        }
        return go;
    }
    function inc(string)
    {
        if (string >= nstrings) return false;
        for (let x = stringfret[string] + 1; x < 13; ++x)
        {
            if (lit[noteat(x, string)])
            {
                stringfret[string] = x;
                return true;
            }
        }
        reset(string);
        return inc(string + 1);
    }
    function reset(string)
    {
        for (let x = 0; x < 12; ++x)
        {
            if (lit[noteat(x, string)])
            {
                stringfret[string] = x;
                break;
            }
        }
    }
    class String
    {
        constructor(n, fret, done)
        {
            this.n    = n;
            this.fret = fret
            this.done = done;
            this.finger = 0;
        }
    }
    class Chord
    {
        constructor(strings, fingers, span)
        {
            this.strings = strings;
            this.fingers = fingers;
            this.span    = span   ;
        }
    }
    function compare(a, b)
    {
        for (let x = 0; x < a.length; ++x)
        {
            if (a[x] < b[x]) return -1;
            if (a[x] > b[x]) return 1;
        }
        return 0;
    }
    function bestchord()
    {
        stringfret = [0, 0, 0, 0, 0, 0];
        let stringsort = [0, 0, 0, 0, 0, 0];
        let stringdone = [0, 0, 0, 0, 0, 0];
        let stringfinger = [0, 0, 0, 0, 0, 0];
        let count = [];
        chordfrets = [];
        for (let x = 0; x < nstrings; ++x)
        {
            stringfret[x] = 0;
        }
        for (let x = 0; x < nstrings; ++x) reset(x);
        let nlit = 0;
        for (let x = 0; x < 12; ++x)
            if (lit[x]) ++nlit;
        let row = 0;
        do
        {
            let fingers = 0;
            let maxfret = 0;
            let minfret = 12;
            for (let x = 0; x < 12; ++x)
            {
                count[x] = 0;
            }
            let pattern = "";
            for (let x = 0; x < nstrings; ++x)
            {
                stringsort[x] = [stringfret[x], -x];
                stringdone[x] = false;
                pattern += stringfret[x].toString();
            }
            if (pattern == "010230")
            {
                let xx = 99;
            }
            stringsort.sort(compare);
            let barres = 0;

            for (let x = 0; x < stringsort.length; ++x)
            {
                let fret = stringsort[x][0];
                let string = -stringsort[x][1];
                if (fret > 0 && !stringdone[string])
                {
                    let barre = true;
                    let countb = 0;
                    for (let y = 0; y < string; ++y)
                    {
                        if (stringfret[y] > -1 && stringfret[y] < fret) barre = false;
                    }
                    if (barre)
                    {
                        for (let y = 0; y < string; ++y)
                        {
                            if (stringfret[y] == fret)
                            {
                                stringdone[y] = true;
                                ++countb;
                            }
                        }
                        if (countb == 0) barre = false;
                    }
                    if (barre)
                        ++barres;
                    else
                        ++fingers;
                    if (fret < minfret) minfret = fret;
                    if (fret > maxfret) maxfret = fret;
                }
                if (fret > -1)
                {
                    n = noteat(fret, string);
                    ++count[n];            
                }
            }
            let mincov = nstrings;
            let maxcov = 0;
            for (let x = 0; x < 12; ++x)
            {
                if (lit[x])
                {
                    if (count[x] < mincov) mincov = count[x];
                    if (count[x] > maxcov) maxcov = count[x];
                }
            }
            let coverage;
            if (mincov == 0) coverage = 50; else coverage = 0;
            let span = maxfret - minfret;
            let score = barres + fingers + span*2 + coverage*2;
            if (fingers + barres > 4) score += 100;
            chordfrets.push([score, barres, fingers, span, coverage, stringfret[0], stringfret[1], stringfret[2], stringfret[3], stringfret[4], stringfret[5]]);
            ++row;
        } while (inc(0));
        chordfrets.sort(compare);
        for (let y = 0; y < 40; ++y)
        {
            for (let x = 0; x < 11; ++x)
            {
                chordfretgrid.rows[y+1].cells[x].innerText = chordfrets[y][x].toString();
            }
        }
        chordshape(chordfrets[0].slice(5));
    }
    function chordshape(shape)
    {
        for (let y = 0; y < nstrings; ++y)
        {
            for (let x = 0; x < 13; ++x)
            {
                let z = fretboard.rows[y].cells[x].style;
                z.border = "none";
            }
        }
        for (let y = 0; y < nstrings; ++y)
        {
            for (let x = 0; x < 13; ++x)
            {
                let z = fretboard.rows[y].cells[x].style;
                z.borderRight = "1px solid";
            }
        }

        for (let y = 0; y < nstrings; ++y)
        {
            fretboard.rows[y].cells[shape[y]].style.border = "7px solid";
        }
    }
    function dochordshape(row)
    {
        function go()
        {
            chordshape(chordfrets[row].slice(5));
        }
        return go;
    }
    function dochord(chord, transpose)
    {
        function go()
        {
            for (let n = 0; n < 12; ++n) lit[n] = 0;
            chord.forEach(function(n, x) { lit[(n+transpose) % 12] = x+1; });
            donotes();
        }
        return go;
    }
    for (let y = 0; y < nstrings - 1; ++y)
    {
        for (let x = 0; x < 12; ++x)
        {
            chordgrid.rows[y+1].cells[x+1].onclick = dochord(chords[y], x);
        }
    }
    for (let y = 0; y < 40; ++y)
    {
        for (let x = 0; x < 11; ++x)
        {
            chordfretgrid.rows[y+1].cells[x].onclick = dochordshape(y);
        }
    }
    donotes();
</script>
</body>
</html>
